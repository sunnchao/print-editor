# 打印模板编辑器

基于 Vue 3 + Ant Design Vue 构建的可视化打印模板设计工具，支持拖拽式布局、Excel 数据绑定和批量打印。

## 技术栈

- **框架**: Vue 3 (Composition API) + TypeScript
- **UI 组件库**: Ant Design Vue 4.x
- **状态管理**: Pinia
- **构建工具**: Vite
- **Excel 解析**: xlsx (SheetJS)
- **PDF 导出**: jspdf + html2canvas
- **拖拽功能**: vuedraggable / @vueuse/core

## 功能特性

### 1. 可视化编辑器

采用三栏式布局：

```
┌─────────────┬─────────────────────────┬─────────────┐
│   物料面板   │         画布区域         │   属性面板   │
│  (左侧栏)    │       (中间预览)         │  (右侧栏)    │
└─────────────┴─────────────────────────┴─────────────┘
```

#### 物料组件

| 组件类型 | 说明                     |
|------|------------------------|
| 文本   | 支持标题+内容分离、数据源绑定、四边独立边框 |
| 图片   | 支持上传或 URL 引用，可设置填充模式   |
| 简单表格 | 基础表格，支持合并单元格           |
| 复杂表格 | 支持列数据绑定、自动行扩展、跨页分割     |
| 线条   | 水平线/垂直线，可设置样式和颜色       |
| 矩形框  | 边框容器，支持圆角和背景色          |

#### 画布操作

- **拖拽放置**: 从左侧物料面板拖入组件
- **自由定位**: 组件可在画布内自由拖拽
- **尺寸调整**: 拖拽边角调整组件大小
- **右键菜单**: 复制、粘贴、删除、层级调整
- **表格编辑**: 合并/拆分单元格、插入/删除行列

### 2. 纸张与页面设置

#### 预设纸张尺寸

- A4 (210 x 297 mm)
- 三联纸 (215 x 93 mm)
- 四联纸 (215 x 70 mm)
- 支持自定义尺寸

#### 页面设置

- **装订线**: 左右装订线宽度设置
- **页眉页脚**: 自定义页眉页脚文字
- **水印**: 支持文字水印，可设置颜色、透明度、角度、字号
- **缩放**: 画布缩放 25% - 200%

### 3. 数据源功能

#### Excel 文件解析

- 支持 `.xlsx` / `.xls` 格式
- 自动识别表头（第一行）
- 智能检测数据范围，过滤空行
- 支持日期格式自动转换
- 合并单元格自动填充处理

#### 数据绑定

- 文本组件可绑定 Excel 列
- 表格组件支持列级数据绑定
- 复杂表格自动根据数据行数扩展

#### 数据持久化

- 数据源自动保存到 IndexedDB
- 页面刷新后自动恢复

### 4. 批量打印

在数据源 Tab 下配置批量打印：

- **启用开关**: 开启/关闭批量打印模式
- **数据源选择**: 选择已上传的 Excel 文件
- **打印范围**: 全部打印 或 指定行范围
- **预览**: 显示将生成的面单数量

批量打印时，每条数据生成一个独立页面，适用于：

- 快递面单批量打印
- 发票批量打印
- 标签批量打印

### 5. 预览与导出

#### 打印预览

- 支持多页预览
- 自动分页（超出页面高度时）
- 复杂表格跨页分割

#### 导出格式

- **打印**: 调用浏览器打印功能
- **PDF**: 导出为 PDF 文件（支持多页）
- **HTML**: 导出为可编辑的 HTML 文件

### 6. 模板管理

- **导出模板**: 保存为 JSON 文件
- **导入模板**: 从 JSON 文件恢复
- **撤销/重做**: 支持操作历史（最多 50 步）

## 项目结构

```
print-editor/
├── src/
│   ├── components/
│   │   ├── MaterialPanel/      # 左侧物料面板
│   │   ├── Canvas/             # 中间画布
│   │   │   ├── index.vue       # 画布主组件
│   │   │   ├── WidgetWrapper.vue  # 组件包装器
│   │   │   └── ContextMenu.vue # 右键菜单
│   │   ├── PropertyPanel/      # 右侧属性面板
│   │   │   ├── index.vue       # 属性面板入口
│   │   │   ├── TextProperties.vue
│   │   │   ├── TableProperties.vue
│   │   │   └── ...
│   │   └── widgets/            # 物料组件实现
│   │       ├── TextWidget.vue
│   │       ├── TableWidget.vue
│   │       ├── ImageWidget.vue
│   │       ├── LineWidget.vue
│   │       └── RectWidget.vue
│   ├── stores/
│   │   ├── editor.ts           # 编辑器状态管理
│   │   ├── datasource.ts       # 数据源管理
│   │   └── template.ts         # 模板管理
│   ├── views/
│   │   ├── Editor.vue          # 编辑器页面
│   │   └── Preview.vue         # 预览页面
│   ├── types/
│   │   └── index.ts            # TypeScript 类型定义
│   └── utils/
│       ├── indexedDB.ts        # IndexedDB 操作
│       ├── exportHtml.ts       # HTML 导出
│       └── exportPdf.ts        # PDF 导出
├── package.json
└── vite.config.ts
```

## 快速开始

### 安装依赖

```bash
npm install
```

### 开发模式

```bash
npm run dev
```

### 构建

```bash
npm run build
```

### 构建并打包为 ZIP

```bash
npm run build:zip
```

## 使用说明

1. **创建模板**: 从左侧物料面板拖拽组件到画布
2. **编辑属性**: 选中组件后在右侧面板编辑属性
3. **绑定数据**: 在"数据源"Tab 上传 Excel，然后在组件属性中选择数据列
4. **批量打印**: 在"数据源"Tab 启用批量打印，选择数据源和打印范围
5. **预览打印**: 点击"打印预览"查看效果，支持导出 PDF/HTML

## 注意事项

- 所有尺寸单位为毫米 (mm)
- 复杂表格绑定数据后会自动扩展行数
- 批量打印需要先上传数据源并启用批量打印开关
- PDF 导出依赖 html2canvas，复杂样式可能有差异
